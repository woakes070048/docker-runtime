#!/bin/bash

set -a
set -e
set -o pipefail

mkdir -p $APP_PATH/deploy
deployPath=$APP_PATH/deploy/$(date +%s)

git clone --single-branch --branch $DEPLOY_BRANCH $DEPLOY_REPOSITORY $deployPath

runtime config:generate /opt/sitepilot/templates /opt/sitepilot/etc --configFile=/opt/sitepilot/runtime.yml --mergeFile=$deployPath/.sitepilot/runtime.yml

chmod +x /opt/sitepilot/etc/deploy.sh

/opt/sitepilot/etc/deploy.sh $deployPath $1

